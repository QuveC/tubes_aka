<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tubes AKA - Metode Horner (Fixed Precision)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2563eb; --danger: #dc2626; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 40px; background: var(--bg); color: #334155; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #0f172a; margin-bottom: 5px; }
        p.subtitle { text-align: center; color: #64748b; margin-top: 0; margin-bottom: 30px; }
        
        .controls { background: #f1f5f9; padding: 20px; border-radius: 8px; display: flex; gap: 10px; justify-content: center; align-items: center; margin-bottom: 20px; }
        input { padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; width: 100px; text-align: center; }
        button { padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { background: #1d4ed8; }
        button:disabled { background: #94a3b8; cursor: wait; }

        .status { text-align: center; font-weight: 600; color: var(--primary); height: 24px; margin-bottom: 10px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 30px; font-size: 14px; }
        th, td { border: 1px solid #e2e8f0; padding: 10px; text-align: center; }
        th { background: #f8fafc; }
        
        .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #94a3b8; }
    </style>
</head>
<body>

<div class="container">
    <h1>Analisis Kompleksitas: Metode Horner</h1>
    <p class="subtitle">Iteratif vs Rekursif (High Precision Mode)</p>

    <div class="controls">
        <label>Input Maks (n):</label>
        <input type="number" id="inputN" value="5000" min="100" max="15000">
        <button id="runBtn" onclick="runBenchmark()">Mulai Test</button>
    </div>

    <div class="status" id="statusText">Siap.</div>
    <canvas id="chart"></canvas>

    <table>
        <thead>
            <tr><th>N</th><th>Iteratif (ms)</th><th>Rekursif (ms)</th></tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <div class="footer">
        Farel Gian Pratama (103012400195) | Akmal Luigi (103012400xxx) | Ahmad Aqiela (103012400077)
    </div>
</div>

<script>
    let myChart = null;

    // --- ALGORITMA --- iteratif
    function hornerIterative(poly, x) {
        let result = poly[0];
        for (let i = 1; i < poly.length; i++) {
            result = result * x + poly[i];
        }
        return result;
    }

    // --- ALGORITMA --- rekursif
    function hornerRecursive(poly, x, i) {
        if (i === poly.length - 1) return poly[i];
        return poly[i] + x * hornerRecursive(poly, x, i + 1);
    }

    const sleep = ms => new Promise(r => setTimeout(r, ms));

    async function runBenchmark() {
        const nMax = parseInt(document.getElementById('inputN').value);
        const btn = document.getElementById('runBtn');
        const status = document.getElementById('statusText');
        const tbody = document.getElementById('tableBody');
        
        btn.disabled = true;
        tbody.innerHTML = "";
        
        const steps = [100, 500, 1000, 2000, 3000, 4000, 5000, nMax].sort((a,b)=>a-b);
        const uniqueSteps = [...new Set(steps)];
        
        const dataI = [];
        const dataR = [];
        const labels = [];
        const xVal = 1.5;

        // PEMANASAN (Warmup) agar JIT Compiler siap
        status.innerText = "Pemanasan CPU...";
        await sleep(100);
        const warmPoly = new Float64Array(100).fill(1);
        for(let i=0; i<10000; i++) hornerIterative(warmPoly, xVal);

        for (let n of uniqueSteps) {
            status.innerText = `Menguji n = ${n} ...`;
            await sleep(20); // Beri nafas UI

            const poly = new Float64Array(n + 1).fill(Math.random());
            
            // --- UKUR ITERATIF ---
            // Kita jalankan 500 kali (BATCH) lalu ambil rata-ratanya
            // agar angkanya tidak 0.00
            const batchSize = 500; 
            
            let tStart = performance.now();
            for(let b=0; b<batchSize; b++) {
                hornerIterative(poly, xVal);
            }
            let tEnd = performance.now();
            // Total waktu dibagi jumlah looping = waktu per 1 eksekusi
            let avgI = (tEnd - tStart) / batchSize;
            dataI.push(avgI);

            // --- UKUR REKURSIF ---
            let avgR = null;
            try {
                // Cek dulu apakah akan stack overflow
                if(n > 9000) throw new Error("Risk");
                
                tStart = performance.now();
                // Batch size untuk rekursif sedikit lebih kecil agar tidak hang lama
                const batchRec = 200; 
                for(let b=0; b<batchRec; b++) {
                    hornerRecursive(poly, xVal, 0);
                }
                tEnd = performance.now();
                avgR = (tEnd - tStart) / batchRec;
            } catch (e) {
                avgR = null; // Stack overflow
            }
            dataR.push(avgR);

            // Update Tabel Realtime
            const rText = avgR === null ? "<span style='color:red'>Stack Overflow</span>" : avgR.toFixed(5);
            const row = `<tr>
                <td>${n}</td>
                <td style="color:#2563eb">${avgI.toFixed(5)}</td>
                <td style="color:#dc2626">${rText}</td>
            </tr>`;
            tbody.innerHTML += row;
        }

        renderChart(uniqueSteps, dataI, dataR);
        status.innerText = "Selesai.";
        btn.disabled = false;
    }

    function renderChart(labels, dI, dR) {
        const ctx = document.getElementById('chart').getContext('2d');
        if(myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Iteratif (ms)',
                        data: dI,
                        borderColor: '#2563eb',
                        backgroundColor: '#2563eb',
                        tension: 0.3
                    },
                    {
                        label: 'Rekursif (ms)',
                        data: dR,
                        borderColor: '#dc2626',
                        backgroundColor: '#dc2626',
                        tension: 0.3
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Grafik Kompleksitas Waktu' }
                },
                scales: {
                    y: { 
                        beginAtZero: true,
                        title: { display: true, text: 'Waktu (milidetik)' }
                    }
                }
            }
        });
    }
</script>

</body>
</html>